name: 자동 브랜치 생성

on:
  issues:
    types: [opened]

jobs:
  create-branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: 이슈 본문에서 주차 정보 추출
        id: extract-week
        run: |
          WEEK_PATTERN="([0-9]+)주차"
          if echo "${{ github.event.issue.body }}" | grep -qE "$WEEK_PATTERN"; then
            WEEK_NUMBER=$(echo "${{ github.event.issue.body }}" | grep -oE "$WEEK_PATTERN" | grep -oE "[0-9]+")
            echo "week_number=$WEEK_NUMBER" >> $GITHUB_OUTPUT
          else
            echo "week_number=" >> $GITHUB_OUTPUT
          fi

      - name: 브랜치 생성
        if: steps.extract-week.outputs.week_number != ''
        run: |
          WEEK_NUMBER="${{ steps.extract-week.outputs.week_number }}"
          BRANCH_NAME="이경준/${WEEK_NUMBER}주차"
          
          echo "생성할 브랜치 이름: $BRANCH_NAME"
          
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          git clone https://github.com/${{ github.repository }}.git
          cd $(basename ${{ github.repository }})
          
          git checkout -b "$BRANCH_NAME"
          git commit --allow-empty -m "이슈 #${{ github.event.issue.number }}을 위한 브랜치 생성: $BRANCH_NAME"
          git push origin "$BRANCH_NAME"
